# SM4算法软件实现与优化

本项目为SM4国密算法的高效软件实现，综合运用多种优化技术，包括传统的软件优化方法和现代CPU指令集加速。

## 项目概述

SM4是一个128位分组密码算法，是中国国家密码局发布的国密算法。本项目旨在通过多种技术手段优化其软件实现性能。

## 优化技术详解

### 1. T-table优化
T-table（查找表）是一种经典的密码学软件优化技术，特别适用于分组密码算法。

#### 核心思想
- 预计算S盒（Substitution-box）和线性变换L的组合运算结果
- 生成包含256个32位整数的查找表
- 用内存查表操作替代复杂的实时计算

#### 实现细节
- 预计算阶段：合并S盒变换和线性变换
- 运行时：直接通过表查找完成轮函数运算
- 权衡：牺牲少量内存空间，换取显著的性能提升

### 2. 指令集优化

#### AES-NI指令集
AES-NI主要针对AES算法，但也可以加速SM4：
- 使用`__builtin_ia32_aesenc128`指令模拟SM4的非线性变换
- 利用AESENC指令的字节替换和位移特性
- 需要通过精心设计的位操作组合来适配SM4结构

#### GF-NI指令集
专门用于加速伽罗瓦域运算的指令集：
- `GF2P8AFFINEINVQB`：用于$GF(2^8)$域上的仿射变换和求逆
- `GF2P8AFFINEQB`：实现仿射变换
- 直接匹配SM4的S盒运算，提供最优化的硬件加速

#### AVX-512和VPROLD
- 使用VPROLD指令实现高效的32位数据并行循环左移
- 利用512位寄存器实现数据并行化处理
- 特别适合在GCM模式下的多数据块并行处理

### 3. SM4-GCM模式优化
结合SM4分组密码与GCM认证加密模式：

#### CTR模式优化
- 利用SIMD指令集并行处理多个计数器块
- 支持SSE/AVX/AVX-512等不同宽度的向量运算

#### GMAC计算优化
- 使用CLMUL指令加速伽罗瓦域乘法
- 优化认证标签的生成过程

## 构建和使用

### 环境要求
- 现代x86处理器（支持AES-NI和AVX-512指令集）
- GCC编译器
- Windows环境需要MSYS2

### 编译选项
```makefile
CFLAGS = -O3 -maes -msse2 -mvaes -mavx512vl -Wall -Wextra
```

### 构建命令
```bash
make
```

## 项目结构
- `sm4.h` - 算法接口定义和常量声明
- `sm4.c` - 核心实现，包含各类优化版本
- `Makefile` - 构建系统配置

